 <title>商户列表</title>

<div class="layui-card layadmin-header">
  <div class="layui-breadcrumb" lay-filter="breadcrumb">
    <a lay-href="">首页</a>
    <a><cite>商户列表</cite></a>
  </div>
</div>
 <div class="layui-tab-content" id="shomanageContent">
        <div class="layui-tab-item shopmanageItem layui-show">

            <div class="addBtn">
                <button class="layui-btn layui-btn-normal " lay-href="/shop/addshop" style="margin-top: 6px;">新增商户</button>
            </div>
            <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief" id="wrap">
                <div class="layui-tab-content buylist-tabcontent">

                    <div class="layui-tab-item layui-show">

                        <table class="layui-table" lay-skin="line">
                            <thead>
                                <tr>
                                    <th>创建时间</th>
                                    <th>商户名称</th>
                                    <th>商户logo</th>
                                    <th>服务</th>
                                    <th>管理员</th>
                                    <th>店员</th>
                                    <th align="right">操作</th>
                                </tr>
                            </thead>
                            <tbody class="tr-content" id="tab0-shop">
                                <tr v-for="(item,index) in list">
                                    <td>{{item.createTime}}</td>
                                    <td>{{item.name}}</td>
                                    <td><img :src="imglink+item.logo" width="60" height="60"></td>
                                    <td>{{item.name}}</td>
                                    <td> <a href="javascript:;" class="layui-btn layui-btn-normal layui-btn-sm remark-btn" @click="look(item.id)">查看</a></td>
                                    <td> <a href="javascript:;" class="layui-btn layui-btn-normal layui-btn-sm remark-btn" @click="look(item.id)">查看</a></td>
                                    <td style="text-align: center;">
                                        <a href="javascript:;" class="layui-btn layui-btn-sm" @click="edit(item.id)">编辑</a>
                                        <a href="javascript:;" class="layui-btn layui-btn-sm layui-btn-danger del-btn" @click="del(item.id)">删除</a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="page" id="shoppage0">

                        </div>
                    </div>
                </div>
            </div>
            <!-- <div class="page" id="page">
            </div> -->

        </div>
    </div>

<script type="text/javascript">
      layui.use(['laydate', 'layer', 'laypage', 'element', 'form', 'admin'], function () {
        var laydate = layui.laydate;
        var layer = layui.layer;
        var laypage = layui.laypage;
        var element = layui.element;
        var form = layui.form;
        var admin = layui.admin
        var $ = layui.$;
        var view = layui.view;
  
    new Vue({
    el:'#wrap',
    data:{
        list:[],
        length:20,
        info:{},
        index:0,
        imglink:imglink,
        token:'',
        channelNo:''
    },
    mounted:function(){
        this.token=localStorage.getItem("token");
        this.channelNo=localStorage.getItem("channelNo")
        this.getlist();
    },
    methods:{
        getlist:function(){
            var that=this;
           var mydata = JSON.stringify({
                channelNo: this.channelNo,
                page:1,
                length:10
            })
            var loading = layer.load(4)

           $.ajax({
                url: link + '/admin/merchant/list.do',
                type: 'post',
                dataType: 'json',
                data: {
                    data: mydata,
                    ts: ts,
                    sign: sign,
                    token: that.token
                },
                success: function (res) {
                    layer.close(loading)
//                  checkToken(res.code)
                    laypage.render({
                        elem: "shoppage0",
                        count: res.data.pageInfo.totalRecord, //totalNums
                        layout: ['count', 'prev', 'page', 'next'],
                        limit: 10,
                        groups: 5,
                        curr: 1,
                        jump: function (obj) {
                            localStorage.setItem("cashCurrPage", obj.curr)

                            var html = "";
                            var dataobj2 = {
                                channelNo: my_c_channel_no,
                                page: obj.curr, //当前页码
                                length: 10, //当前页显示条数
                            }
                            var mydata = JSON.stringify(dataobj2)
                            $.ajax({
                                url: link + '/admin/merchant/list.do',
                                type: 'post',
                                dataType: 'json',
                                data: {
                                    data: mydata,
                                    ts: ts,
                                    sign: sign,
                                    token: that.token
                                },
                                success: function (res) {
                                    if (res.code == 0) {
                                        //console.log(res.data.list)
                                        for (var i = 0; i < res.data.list.length; i++) {
                                            res.data.list[i].createTime=formatDate(new Date(parseInt(res.data.list[i].createTime)));
                                        }
                                        that.list = res.data.list;
                                    }
                                }
                            })
                        }
                    })
                },
                error: function () {
                    layer.close(loading)
                    layer.msg('请求服务器失败！！')
                }
            });
        },
        look:function(id){
            location.hash = '/shop/shopadmin/id=' + id
        },
        
        edit:function(id){
            location.hash = '/shop/addshop/id=' + id
        },
        del:function(id){
            var that=this;
            var mydata = JSON.stringify({
                "id": id
            })
            layer.confirm('是否要删除?', {
                icon: 3,
                title: '提示'
            }, function (index) {
                //do something
                $.ajax({
                    url: link + '/admin/merchant/delete.do',
                    type: 'post',
                    dataType: 'json',
                    data: {
                        data: mydata,
                        sign: sign,
                        ts: ts,
                        token: that.token
                    },
                    success: function (res) {
                        checkToken(res.code)
                        layer.close(index)
                        if (res.code == 0) {
                            layer.msg('删除成功', {
                                icon: 1,
                                time: 1000 //1秒关闭（如果不配置，默认是3秒）
                            }, function () {
                                //window.location.href = location.href;
                                // var status = $('.shop-status li.layui-this').attr('data-on')
                                that.getlist();
                            });

                        } else {
                            //console.log("删除失败：" + res.info)
                            layer.closeAll();
                        }
                    },
                    error: function () {
                        layer.msg('请求服务器失败！！')
                    }
                })

            });
        },
    }
});
  })
</script>