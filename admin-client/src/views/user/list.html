<title>用户列表</title>
<style>
     .blueTxt {
        color: #1E99FF;
        cursor: pointer;
    }
</style>
<div class="layui-card layadmin-header">
  <div class="layui-breadcrumb" lay-filter="breadcrumb">
    <a lay-href="">首页</a>
    <a><cite>用户列表</cite></a>
  </div>
</div>
   <div class="layui-tab-content" id="wrap">
                <div class="layui-tab-item couponItem layui-show">
        <!-- <div style="background: #fff;margin: 10px 0" class="layui-form layui-card-header layuiadmin-card-header-auto" lay-filter="layadmin-useradmin-formlist">

                <div class="layui-form-item">
                    <div class="layui-inline">
                        <div class="layui-input-block" style="margin-left: 0">
                            <select id="classifySel" name="role" lay-filter="classifySel">
                                <option value="-1">全部</option>
                                <option value="0">特等奖</option>
                                <option value="1">一等奖</option>
                                <option value="2">二等奖</option>
                                <option value="3">三等奖</option>
                                <option value="4">四等奖</option>
                            </select>
                        </div>
                    </div> -->
                <div class="layui-form-item">
                    <br/>
                    <div class="layui-inline">
                        <div class="layui-input-inline">
                            <input type="text" id="searchTxt" name="telphone" placeholder="输入用户昵称或手机号" autocomplete="off" class="layui-input">
                        </div>
                        <button id="searchBtn" class="layui-btn layui-btn-normal" lay-submit="" lay-filter="LAY-user-back-search">
                            搜索
                        </button>
                    </div>
                </div>
            <!-- </div>  -->
            <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief" >
                <div class="layui-tab-content buylist-tabcontent">

                    <div class="layui-tab-item layui-show">

                        <table class="layui-table" lay-skin="line">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>头像</th>
                                    <th>昵称</th>
                                    <th>性别</th>
                                    <th>手机号</th>
                                    <th>领取记录</th>
                                    <th>积分</th>
                                </tr>
                            </thead>
                            <tbody class="tr-content" id="tab0-shop">
                                
                            </tbody>
                        </table>
                        <div class="page" id="page">

                        </div>
                    </div>
                </div>
            </div>

        </div>
        </div>

<script type="text/javascript">
 	layui.use(['laydate', 'layer',"form", 'laypage'], function () {
        var laydate = layui.laydate;
        var form = layui.form;
        var layer = layui.layer;
        var laypage = layui.laypage;
        var router = layui.router();
        form.render()
		isLogin()

		var pageSession = sessionStorage.getItem('cutuseCurrPage')
		var listPage = pageSession ? pageSession : 1

		var myid = router.search.id //location.search.split('=')[1];
		var status = router.search.type //location.search.split('=')[1];
        
		var showstatus = '';
        form.on('select(classifySel)', function (data) {
            //console.log(data.value)
            doAjax(1)
        })
        $("#searchBtn").click(function(){
            doAjax(1)
        })
		doAjax(listPage)

		function doAjax(mypage) {
            // var type= $("#classifySel option:selected").val();
            var search= $("#searchTxt").val();
			var dataobj1 = {
                channelNo: my_c_channel_no,
                search:search,
				page: mypage, //首次加载的页码
				pageSize: 10, //当前页显示条数


			}

			var mydata = JSON.stringify(dataobj1)
			$.ajax({
				url: link + '/admin/user/list.do',
				type: 'post',
				dataType: 'json',
				data: {
					data: mydata,
					ts: ts,
					sign: sign,
					token: mytoken
				},
				success: function (res) {
					checkToken(res.code)
					if (res.code != 0) {
						layer.msg('加载失败：' + res.info);
						return false;
					}

          var listdata = res.data.list;
          var html = "";
					var sex = ''
					var nickname = ''
                    var tel=''
					if (listdata.length) {
						//console.log('test')
						for (var i = 0; i < listdata.length; i++) {
                            if(listdata[i].sex==0){
                            sex="未知"
                            }else if(listdata[i].sex==1){
                            sex="男"
                            }else{
                            sex="女"
                            }
                            if(!listdata[i].tel){
                                tel='/'
                            }else{
                                tel=listdata[i].tel
                            }
							html += '<tr>' +
								'<td>' + listdata[i].id + '</td>' +
								'<td><img width="45" height="45" src="' + listdata[i].headimgurl + '"/></td>' +
								'<td>' + listdata[i].nickName + '</td>' +
								'<td>' + sex + '</td>' +
								'<td>' + tel + '</td>' +
								'<td><span title="" data-id="' + listdata[i].id + '" class="blueTxt looklottery viewNum">查看</span></td>' +
								'<td>' + 0 + '</td>' +
								'</tr>'
						}
					} else {
						html = "暂无数据";
					}

					$("#tab0-shop").html(html);

	
					laypage.render({
						elem: "page",
						count: res.data.pageInfo.totalRecord, //totalNums
						layout: ['count', 'prev', 'page', 'next'],
						limit: 10,
						groups: 5, //连续显示分页数
						curr: mypage,
						jump: function (obj, first) {
							sessionStorage.setItem('cutuseCurrPage', obj.curr)

							if (!first) {
								var curr = obj.curr;

								doAjax(curr)
							}

						}
					})
				},
				error: function () {
					layer.msg('请求服务器失败！！')
				}
			});
    }
    $(document).on("click",'.viewNum', function () {
      //console.log(99999)
      var _id = $(this).data('id');
      location.hash = '/user/uselist/id=' + _id
    })
	});
</script>