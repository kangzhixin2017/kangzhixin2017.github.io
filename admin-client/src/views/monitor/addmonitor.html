<div class="layui-card layadmin-header">
    <div class="layui-breadcrumb" lay-filter="breadcrumb">
        <a lay-href="monitor/monitor">监控管理</a>
        <a>
            <cite>新增监控</cite>
        </a>
    </div>
</div>
<div class="shop-manage-content" style="padding: 10px;">

    <div class="content-body" style="padding: 10px;background: #fff">

        <form class="layui-form layui-form-pane1" action="">


            <div class="layui-form-item ">
                <label class="layui-form-label">
                    <span class="star">*</span>监控名称:</label>
                <div class="layui-input-inline">
                    <input id="name" type="text" name="name" lay-verify="required|name" required placeholder="输入监控名称" autocomplete="off" class="layui-input jing">
                </div>
            </div>
            <div class="layui-form-item ">
                <label class="layui-form-label">
                    <span class="star">*</span>所属校区:</label>
                <div class="layui-input-inline">
                    <input id="school" type="text" name="school" lay-verify="required|name" required placeholder="输入所属校区" autocomplete="off" class="layui-input jing">
                </div>
            </div>
            <div class="layui-form-item ">
                <label class="layui-form-label">
                    <span class="star">*</span>显示顺序:</label>
                <div class="layui-input-inline">
                    <input id="sort" type="text" name="sort" lay-verify="required|name" required placeholder="数字越大越靠前" autocomplete="off" class="layui-input jing">
                </div>
            </div>
            <div class="layui-form-item ">
                <label class="layui-form-label">
                    <span class="star">*</span>路径:</label>
                <div class="layui-input-inline">
                    <input id="url" type="text" name="url" lay-verify="required|name" required placeholder="输入路径" autocomplete="off" class="layui-input jing" style="width: 50vw;min-width: 190px;">
                </div>
            </div>
            
        </form>

        <button class="layui-btn layui-btn-normal addshopSubmit" lay-submit lay-filter="*">立即提交</button>
    </div>

</div>
<script src="layui/plupload.full.min.js"></script>
<script src="layui/upload.js"></script>
<script type="text/javascript">
    upload('logo');
    layui.use(['form', 'laydate', 'layer'], function () {
        var form = layui.form;
        var laydate = layui.laydate;
        var layer = layui.layer;
        var router = layui.router()
        form.render();


        var myid = router.search.id//location.search.split('=')[1];
        
        //console.log("myid:",myid)
        
        var parentId
        
		if (myid) {
            getinfo();
            function getinfo() {
                var parem = {
                    id: myid
                }
                $.ajax({
                    url: link + '/admin/monitorConfig/get.do',
                    type: 'POST',
                    dataType: 'json',
                    data: parem,
                    success: function (res) {
                    		//console.log(res)
                        if (res.code == 0) {
                            $('#name').val(res.data.title);
                            $('#sort').val(res.data.sort);
                            $('#school').val(res.data.school);
                            $('#url').val(res.data.url);
                            form.render();
                            parentId = res.data.parentId
                        }
                    },
                    error: function () {
                        layer.msg('请求服务器失败！！')
                    }
                });
            }
        } else {
            $("#logo").attr("src", "http://mayijl.oss-cn-beijing.aliyuncs.com/xcx/4HNzTaATDtJB7FM2miXnxB.png");
        }

        $(document).off("click").on("click", ".addshopSubmit", function () {
            toSubmit();

        });

        function toSubmit() {
            var name = $('#name').val();
            var school = $('#school').val();
            var sort = $('#sort').val();
		    var url = $('#url').val();
            var dataObj = {
                id: ''||myid,
                title: name,
                school: school,
                sort: sort,
                url: url,
            }
            var mydata = JSON.stringify(dataObj)
            //console.log(mydata)
            
            var loadicon = layer.load(4); //加载动画

            $.ajax({
                url: link + '/admin/monitorConfig/save.do',
                type: 'post',
                dataType: 'json',
                data: {
                    data: mydata,
                    ts: ts,
                    sign: sign,
                    token: mytoken
                },

                success: function (res) {
                		//console.log(res)
                    checkToken(res.code)
                    layer.close(loadicon)
                    if (!res.code) {
                        layer.msg('提交成功', {
                            icon: 1,
                            time: 1000 //1秒关闭（如果不配置，默认是3秒）
                        }, function () {

                            // 获得frame索引
                            // var index = parent.layer.getFrameIndex(window.name);
                            // //关闭当前frame
                            // parent.layer.close(index);
                            // window.parent.location.reload();
                            
                            	location.hash = '/monitor/monitor'



                        });

                    } else {
                        layer.msg(res.info, {
                            icon: 2,
                            time: 2000
                        });
                    }

                },
                error: function (jqXHR, textStatus, errorThrown) {
                    /*错误信息处理*/
                    layer.close(loadicon);
                    layer.msg('请求失败，原因：' + errorThrown + ',状态码：' + jqXHR.status);


                }

            });


        }
    })
</script>